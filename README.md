## Тестовое задание на курс Python **ШИФТ ЦФТ**.

## Задание: 

Реализуйте REST-сервис просмотра текущей зарплаты и даты следующего
повышения. Из-за того, что такие данные очень важны и критичны, каждый
сотрудник может видеть только свою сумму. Для обеспечения безопасности, вам
потребуется реализовать метод где по логину и паролю сотрудника будет выдан
секретный токен, который действует в течение определенного времени. Запрос
данных о зарплате должен выдаваться только при предъявлении валидного токена.

**Технические требования:**

1. Код размещен и доступен в публичном репозитории **GitLab**;
2. Должна быть оформлена инструкция;
3. Сервис должен быть реализован на **FastAPI**.

**Необязательные технические требования:**

1. Использовать менеджер зависимостей **poetry**;
2. Написать тесты с использованием **pytest**;
3. Реализовать возможность собирать и запускать контейнер с сервисом в **Docker**.


## Реализация задания

Использованные технологии:

* Веб-фреймворк **FastAPI**;
* СУБД **SQLite**;
* ASGI сервер **uvicorn**;
* Тесты **pytest**;
* Менеджер зависимостей **poetry**.

Были выполнены все основные и необязательные технические требования, кроме возможности собирать и запускать контейнер на Docker.

* Регистрация идет по JSON файлу с параметрами;
* По имени и паролю пользователь может получить токен, который будет валидный 30 секунд после получения (специально сделал поменьше чтобы можно было отследить когда токен перестает быть валидным);
* Запрос данных о зарплате и следующем повышении выдается только при предъявлении валидного токена.

## API сервиса

В **API** используются следующие пути:

* **/register/** - POST запрос с **JSON** телом для создания пользователя;

* **/get/** - GET запрос для получения данных о зарплате и следующем повышении, по токену;

* **/token/** - POST запрос для получения нового токена авторизации;


## Как пользоваться приложением?

1. Запустив приложение, перейдите по адресу **localhost:8000/docs/**.
2. Создайте пользователя через POST запрос к ***/register/***.

![alt text](https://github.com/Nikomol/python_backend_shift/assets/114502362/ace3c277-f663-4715-927c-94d26a4b699e)

3. Нажмите кнопку **Authorize**, введите данные только что созданного пользователя.

![image](https://github.com/Nikomol/python_backend_shift/assets/114502362/e83174e3-e462-4b8f-b41e-ef360e9435b7)

4. Получите валидный токен для этого пользователя через POST запрос к ***/token/***.

![image](https://github.com/Nikomol/python_backend_shift/assets/114502362/e144a15b-8ec7-402c-868f-361458dad490)

5. Скопируйте токен в **HTTPBearer** в **Authorize**.

![image](https://github.com/Nikomol/python_backend_shift/assets/114502362/165ffcb7-f8c3-4674-9975-b3ca06864c2d)

6. Получите данные о зарплате и о дате следубщего повышения пользователя, через GET запрос к ***/salary/***.

![image](https://github.com/Nikomol/python_backend_shift/assets/114502362/9b3f8262-0dec-42f4-87fa-ceae21530169)

## Установка

Выполните следующие команды:

1. Склонируйте репозиторий:<br>
    `$ git clone https://gitlab.com/shift-project/python_backend_shift.git`

2. Активируйте виртуальное окружение:<br>
    `$ poetry shell`

3. Загрузите зависимости:<br>
    `$ poetry install`

4. Если необходимо, в файле **.env** подставьте свои значения.

5. Запустите сервер **uvicorn**:<br>

    `$ uvicorn src.main:app --reload`

Запущенное приложение доступно по адресу **localhost:8000**. Интерактивная документация **localhost:8000/docs/**.

## Тесты
**Для запуска вручную:**

Для запуска тестов требуется фреймворк **pytest**, так что он должен быть установлен в вашем виртуальном окружении.

1. Активируйте виртуальное окружение:<br>
    `$ poetry shell`

2. Загрузите зависимости:<br>
    `$ poetry install`

3. Запустите тесты:<br>
    `$ pytest`

## Структура базы данных

В приложении используется СУБД **SQLite**. В ходе работы создается файл базы данных **database.db** с одной таблицей **employees** со следующими столбцами:

![image](https://github.com/Nikomol/python_backend_shift/assets/114502362/6c393ba5-760d-4a3e-b48c-8c0b580606af)
